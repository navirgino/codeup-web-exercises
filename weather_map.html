<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">

    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.css' rel='stylesheet'/>
    <!--Import Google Icon Font-->
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="materialize/css/materialize.min.css" media="screen,projection"/>
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

    <style>
        body {
            background-color: mintcream;
        }

        #map {
            width: 100%;

            height: 400px;
        }


    </style>
    <title>Weather Map</title>

</head>
<div class="nav-container">
    <!--nav bar below-->

    <nav class="nav-wrapper blue-grey">
        <h6>My Weather Map</h6>
    </nav>
    <!--search form below-->
    <form>
        <div class="input-field">
            <input id="input" type="search" placeholder="Show me the weather in... city, zip, or place" required>
            <button id="geoSearch" class="btn waves-effect waves-light" type="submit" name="action">Submit
                <i class="material-icons right">search</i></button>
            <label class="label-icon" for="input"></label>
            <i class="material-icons">close</i>
        </div>
    </form>
    <!--search form end-->
</nav>
</div>

<!--map below-->
<div class="container center-align">
    <div class="row">

    </div>
</div>


<div id="map"></div>



<!--MAPBOX DARKSKY JS-->

<script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>

<!-- Compiled and minified JavaScript -->
<script src="js/jquery-2.2.4.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/js/materialize.min.js"></script>
<script src="js/keys.js"></script>
<script src="js/mapbox-geocoder-utils.js"></script>


<script>
    $(document).ready(function () {
        "use strict";

        //i think we have to wrap darksky in mapbox but let's try..

        //initialize mapbox
        mapboxgl.accessToken = mapboxToken;
        var map = new mapboxgl.Map({
            container: 'map',
            style: 'mapbox://styles/mapbox/satellite-streets-v10',
            zoom: 4,
            center: [-98.4916, 29.4252],
            number: 7
        });

        //marker down below
        var marker = new mapboxgl.Marker({
            draggable: true
        })
            .setLngLat([-98.4916, 29.4252])
            .addTo(map);

        //dark sky variable
        var darkSkyMap = "https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkyKey + "/29.4241,-98.4936";
        console.log(darkSkyMap);

//if icon type === "type of day
        //output the image
//icon array of objects
        var icon = [
            {
                type: "clear-day",
                image: "<img src='weather-icons/Sun.svg'>"
            },
            {
                type: "clear-night",
                image: "<img src='weather-icons/Moon.svg'>"
            },
            {
                type: "rain",
                image: "<img src='weather-icons/Cloud-Rain-Alt.svg'>"
            },
            {
                type: "snow",
                image: "<img src='weather-icons/Cloud-Snow-Alt.svg'>"
            },
            {
                type: "sleet",
                image: "<img src='weather-icons/Cloud-Hail.svg'>"
            },
            {
                type: "wind",
                image: "<img src='weather-icons/Cloud-Wind.svg'>"
            },
            {
                type: "fog",
                image: "<img src='weather-icons/Cloud-Fog-Alt.svg'>"
            },
            {
                type: "cloudy",
                image: "<img src='weather-icons/Cloud.svg'>"
            },
            {
                type: "partly-cloudy-day",
                image: "<img src='weather-icons/Cloud-Sun.svg'>"
            },
            {
                type: "partly-cloudy-night",
                image: "<img src='weather-icons/Cloud-Moon.svg'>"
            }
        ];


        function getDarkSkyData(darkSkyMap) {

            $.ajax(darkSkyMap).done(function (data) {


                    //variables for day, temp, empty append, and today
                    // MS IN A DAY FOR QUICK MATH
                    var msInADay = 86400000;

                    //DAILY DATA FOR EASY ACCESS
                    var day = data.daily.data;

                    //TODAY'S DATA

                    var today = new Date().getDay();
                    var todayTemp = data.currently.temperature;
                    var todayClouds = data.currently.icon;
                    var dayToday = new Date(getTime());

                    //TOMORROW'S DATA
                    // var tomorrow = today + 1;

                    //SHOWS DATE
                    var dayTomorrow = (new Date(getTime() + msInADay));

                    //DAY AFTER TOMORROW DATA

                    //SHOWS DATE
                    var dayAfterTom = (new Date(getTime() + msInADay * 2));
                    console.log(dayAfterTom);


                    //FOR LOOP FOR SWITCH CASES
                    for (var i = 0; i < day.length; i++) {
                        icon = day[i].icon;
                        var dayOfWeek = (new Date((day[i].time) * 1000)).getDay();

                        switch (dayOfWeek) {
                            case 0:
                                dayOfWeek = i;
                                $('.row ').append("<div class='col s7 m4 waves-effect center-align'>" +
                                    "<div class='card blue-grey darken-1'>" +
                                    "<div class='card-content white-text'>" +
                                    dayToday + '<hr>' +
                                    "<div>" +
                                    "<span id='day-today'>" +
                                    "Temperature: " +
                                    "<br>" +
                                    todayTemp + "°" +
                                    "</span>" +
                                    "</div>" +
                                    "<div>" +
                                    "Clouds: " +
                                    todayClouds +
                                    "</div>" +
                                    "<div>" +
                                    "Humidity: " +
                                    data.currently.humidity +
                                    "</div>" +
                                    "<div>" +
                                    "Wind: " +
                                    data.currently.windGust +
                                    "</div>" +
                                    "<div>" +
                                    "Pressure: " +
                                    data.currently.pressure +
                                    "</div>" +
                                    "</div>" +
                                    "</div>" +
                                    "</div>" +

                                    "</div>");
                                break;
                            case 1:
                                dayOfWeek = i + 1;
                                $('.row').append("<div class='col s7 m4 center-align'>" +
                                    "<div class='card blue-grey darken-1'>" +
                                    "<div class='card-content white-text'>" +
                                    dayTomorrow + '<hr>' +
                                    "<div>" + "Temperature: " + "<br>" +
                                    Math.round((day[i].temperatureHigh + day[i].temperatureLow) / 2) + "°" + "<br>" +
                                    "</div>" +
                                    "<div id='cloud'>" + "Clouds: " +
                                    day[i].icon +
                                    "</div>" +
                                    "<div>" +
                                    "Humidity: " +
                                    day[i].humidity +
                                    "</div>" +
                                    "<div>" +
                                    "Wind: " +
                                    day[i].windGust +
                                    "</div>" +
                                    "<div>" +
                                    "Pressure: " +
                                    day[i].pressure +

                                    "</div>" +
                                    "</div>" +
                                    "</div>" +
                                    "</div>" +

                                    "</div>");
                                break;
                            case 2:
                                dayOfWeek = i + 2;
                                $('.row').append("<div class='col s6 m4  center-align'>" +
                                    "<div class='card blue-grey darken-1'>" +
                                    "<div class='card-content white-text'>" +
                                    dayAfterTom + '<hr>' +
                                    "<div>" + "Temperature: " + "<br>" +
                                    Math.round((day[i].temperatureHigh + day[i].temperatureLow) / 2) + "°" + "<br>" +
                                    "</div>" +
                                    "<div>" + "Clouds: " +
                                    day[i].icon +
                                    "</div>" +
                                    "<div>" +
                                    "Humidity: " +
                                    day[i].humidity +
                                    "</div>" +
                                    "<div>" +
                                    "Wind: " +
                                    day[i].windGust +
                                    "</div>" +
                                    "<div>" +
                                    "Pressure: " +
                                    day[i].pressure +
                                    "</div>" +
                                    "</div>" +
                                    "</div>" +
                                    "</div>");
                                break;
                        }
                    }

                    //append icons here
                    function appendImg(data) {
                        $('#cloud').html(getImg(data));
                    }

                    appendImg();

                    // make a for loop to loop through the array for icons, and day per week.
                    // for (var i = 0; i < day.length - 1; i++) {
                    //     icon = day[i].icon;
                    //     var dayOfWeek = (new Date((day[i].time) * 1000)).getDay();

                    /*now we create a switch case to be able to
                    change the number to an actual 'day'(string)
                    and give it all the current info yada yada and all the goodness*/

                    // switch (dayOfWeek) {
                    //     case today:
                    //         dayOfWeek = 'Currently';
                    //         $('#row-one').append("<div class='col s12 m1.5 center-align'>" +
                    //             "<div class='card blue-grey darken-1'>" +
                    //             "<div class='card-content white-text'>" +
                    //             dayToday + '<hr>' +
                    //             "<div>" +
                    //             "<span id='day-today'>" +
                    //             "Temperature: " +
                    //             "<br>" +
                    //             todayTemp +
                    //             "</span>" +
                    //             "</div>" +
                    //             "<div>" +
                    //             "Clouds: " +
                    //             todayClouds +
                    //             "</div>" +
                    //             "<div>" +
                    //             "Humidity: " +
                    //             data.currently.humidity +
                    //             "</div>" +
                    //             "<div>" +
                    //             "Wind: " +
                    //             data.currently.windGust +
                    //             "</div>" +
                    //             "<div>" +
                    //             "Pressure: " +
                    //             data.currently.pressure +
                    //             "</div>" +
                    //             "</div>" +
                    //             "</div>" +
                    //             "</div>" +
                    //             "</div>");
                    //         break;


                    // case 0:
                    //     dayOfWeek = 'Sunday';
                    //     $('#row-two').append("<div class='col s12 m1.5 center-align'>" +
                    //         "<div class='card blue-grey darken-1'>" +
                    //         "<div class='card-content white-text'>" +
                    //         "Sunday" + '<hr>' +
                    //         "<div>" + "Temperature: " + "<br>" +
                    //         "High: " + day[i].temperatureHigh + "<br>" +
                    //         "Low: " + day[i].temperatureLow + "<br>" +
                    //         "</div>" +
                    //         "<div>" + "Clouds: " +
                    //         day[i] +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Humidity: " +
                    //         day[i].humidity +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Wind: " +
                    //         day[i].windGust +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Pressure: " +
                    //         day[i].pressure +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>");

                    //     break;
                    // case 1:
                    //     dayOfWeek = 'Saturday';
                    //     $('#row-three').append("<div class='col s12 m1.5 center-align'>" +
                    //         "<div class='card blue-grey darken-1'>" +
                    //         "<div class='card-content white-text'>" +
                    //         "Saturday" + '<hr>' +
                    //         "<div>" + "Temperature: " + "<br>" +
                    //         "High: " + day[i].temperatureHigh + "<br>" +
                    //         "Low: " + day[i].temperatureLow + "<br>" +
                    //         "</div>" +
                    //         "<div>" + "Clouds: " +
                    //         day[i].icon +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Humidity: " +
                    //         day[i].humidity +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Wind: " +
                    //         day[i].windGust +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Pressure: " +
                    //         day[i].pressure +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>");
                    //
                    //     break;
                    // case 2:
                    //     dayOfWeek = 'Monday';
                    //     $('#row-four').append("<div class='col s12 m1.5 center-align'>" +
                    //         "<div class='card blue-grey darken-1'>" +
                    //         "<div class='card-content white-text'>" +
                    //         "Monday" + '<hr>' +
                    //         "<div>" + "Temperature: " + "<br>" +
                    //         "High: " + day[i].temperatureHigh + "<br>" +
                    //         "Low: " + day[i].temperatureLow + "<br>" +
                    //         "</div>" +
                    //         "<div>" + "Clouds: " +
                    //         day[i].icon +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Humidity: " +
                    //         day[i].humidity +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Wind: " +
                    //         day[i].windGust +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Pressure: " +
                    //         day[i].pressure +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>");
                    //     break;
                    // case 3:
                    //     dayOfWeek = 'Tuesday';
                    //     $('#row-five').append("<div class='col s12 m1.5 center-align'>" +
                    //         "<div class='card blue-grey darken-1'>" +
                    //         "<div class='card-content white-text'>" +
                    //         "Tuesday" + '<hr>' +
                    //         "<div>" + "Temperature: " + "<br>" +
                    //         "High: " + day[i].temperatureHigh + "<br>" +
                    //         "Low: " + day[i].temperatureLow + "<br>" +
                    //         "</div>" +
                    //         "<div>" + "Clouds: " +
                    //         day[i].icon +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Humidity: " +
                    //         day[i].humidity +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Wind: " +
                    //         day[i].windGust +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Pressure: " +
                    //         day[i].pressure +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>");
                    //
                    //     break;
                    // case 4:
                    //     dayOfWeek = 'Wednesday';
                    //     $('#row-six').append("<div class='col s12 m1.5 center-align'>" +
                    //         "<div class='card blue-grey darken-1'>" +
                    //         "<div class='card-content white-text'>" +
                    //         "Wednesday" + '<hr>' +
                    //         "<div>" + "Temperature: " + "<br>" +
                    //         "High: " + day[i].temperatureHigh + "<br>" +
                    //         "Low: " + day[i].temperatureLow + "<br>" +
                    //         "</div>" +
                    //         "<div>" + "Clouds: " +
                    //         day[i].icon +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Humidity: " +
                    //         day[i].humidity +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Wind: " +
                    //         day[i].windGust +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Pressure: " +
                    //         day[i].pressure +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>");
                    //     break;
                    // case 5:
                    //     dayOfWeek = 'Thursday';
                    //     $('#row-seven').append("<div class='col s12 m1.5 center-align'>" +
                    //         "<div class='card blue-grey darken-1'>" +
                    //         "<div class='card-content white-text'>" +
                    //         "Thursday" + '<hr>' +
                    //
                    //         "<div>" + "Temperature: " + "<br>" +
                    //         "High: " + day[i].temperatureHigh + "<br>" +
                    //         "Low: " + day[i].temperatureLow + "<br>" +
                    //         "</div>" +
                    //         "<div>" + "Clouds: " +
                    //         day[i].icon +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Humidity: " +
                    //         day[i].humidity +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Wind: " +
                    //         day[i].windGust +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Pressure: " +
                    //         day[i].pressure +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>");
                    //     break;
                    // case 6:
                    //     dayOfWeek = 'Friday';
                    //     $('#row-eight').append("<div class='col s12 m1.5 center-align'>" +
                    //         "<div class='card blue-grey darken-1'>" +
                    //         "<div class='card-content white-text'>" +
                    //         "Friday" + '<hr>' +
                    //
                    //         "<div>" + "Temperature: " + "<br>" +
                    //         "High: " + day[i].temperatureHigh + "<br>" +
                    //         "Low: " + day[i].temperatureLow + "<br>" +
                    //         "</div>" +
                    //         "<div>" + "Clouds: " +
                    //         day[i].icon +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Humidity: " +
                    //         day[i].humidity +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Wind: " +
                    //         day[i].windGust +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Pressure: " +
                    //         day[i].pressure +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>");
                    //     break;
                    // case 7:
                    //     dayOfWeek = 'Saturday';
                    //     $('#row-nine').append("<div class='col s12 m1.5 center-align'>" +
                    //         "<div class='card blue-grey darken-1'>" +
                    //         "<div class='card-content white-text'>" +
                    //         "Saturday" + '<hr>' +
                    //         "<div>" + "Temperature: " + "<br>" +
                    //         "High: " + day[i].temperatureHigh + "<br>" +
                    //         "Low: " + day[i].temperatureLow + "<br>" +
                    //         "</div>" +
                    //         "<div>" + "Clouds: " +
                    //         day[i].icon +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Humidity: " +
                    //         day[i].humidity +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Wind: " +
                    //         day[i].windGust +
                    //         "</div>" +
                    //         "<div>" +
                    //         "Pressure: " +
                    //         day[i].pressure +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>" +
                    //         "</div>");
                    //     break;


                }
            );

        }

        getDarkSkyData(darkSkyMap);
        geoCode(darkSkyMap);


        function getImg(data) {

            if (data === "clear-day") {
                return data.image[0];
            } else if (data === "clear-night") {
                return icon.image[1];
            } else if (data === "rain") {
                return icon.image[2];

            } else if (data === "snow") {
                return data.icon.image[3];
            } else if (data === "sleet") {
                return data.icon.image[4];
            } else if (data === "wind") {
                return data.icon.image[5];
            } else if (data === "fog") {
                return data.icon.image[6];
            } else if (data === "cloudy") {
                return data.icon.image[7];
            } else if (data === "partly-cloudy-day") {
                return data.icon.image[8];
            } else if (data === "partly-cloudy-night") {
                console.log("partly-cloud-night");
                return data.icon.image[9];

            } else {
                console.log("ok lol")
            }
        }


        // marker drop logic

        marker.on('dragend', onDragEnd);

        function onDragEnd() {
            var lngLat = marker.getLngLat();
            console.log(lngLat);
            $(' .row ').html("");
            var weather = "https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkyKey + "/" + lngLat.lat + "," + lngLat.lng;
            getDarkSkyData(weather);
        }

        //geocoder logic

        function geoCode() {
            $('#geoSearch').click(function (e) {
                e.preventDefault();
                var input = $('#input').val();
                console.log(input);
                geocode(input, mapboxToken).then(function (result) {
                    console.log(result);

                    map.flyTo({
                        center: result,
                        zoom: 7,
                        speed: 0.5
                    });
                    marker.setLngLat(result);

                    $(' .row ').html('');

                    onDragEnd();
                });
            });
        }
    });

    //initialize materialize button
    // $(document).ready(function () {
    //     $('.fixed-action-btn').floatingActionButton();
    // });

    //collapse button stuff
    //     function clickTodayButton(){
    //         $('#today').click(function(e){
    //             e.preventDefault();
    //             $('#row-one').children().hide();
    //             $('#row-one').children().first().show().addClass('row-one');
    //         })
    //     }
    // clickTodayButton()
</script>


</body>
</html>